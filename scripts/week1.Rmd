---
title: "swing_states"
output: html_document
date: '2022-09-11'
---

```{r}
library(tidyverse)
library(usmap)
library(ggplot2)

# Read in datasets
popvote_df <- read_csv("..data/week1/house nationwide vote by party 1948-2020.csv")
pvstate_df <- read_csv("Section data/house party vote share by district 1948-2020.csv")

```

One common way, and very reasonable way, to predict how states may vote in an upcoming election is by looking at the vote share for a specific party over time. Below are plots of the United States with states highlighted different shades of red depending on the percentage of voters that voted for Republicans. Darker shades of red indicate that Republicans carried the state by a wide margin, while lighter shades mean it was close or went to the Democrats. 
```{r}
margin = pvstate_df %>%
  filter(raceYear>=1980) %>%
    select(raceYear, State, RepVotes, DemVotes) %>%
  # summarize party vote share by state
  group_by(State,raceYear) %>%
# mutate Rep vote margin by state %>%
    mutate(R_votemargin_st = 100*(sum(RepVotes))/
                            sum(RepVotes + DemVotes),
           D_votemargin_st = 100*(sum(DemVotes))/
                            sum(RepVotes + DemVotes)) %>%
  select(raceYear,State, R_votemargin_st,D_votemargin_st) %>%
    rename(state = State)%>% distinct()
# plot

plot_usmap(data = margin, regions = "state", values = "R_votemargin_st") +
  facet_wrap(facets = raceYear~.) +
  scale_fill_gradient2(low = "blue",mid = "white",high="red",name = "Swing Margin") + 
  labs(title = "Republican Win Share for House Elections over Time",subtitle = "Larger Numbers corresponds to a larger vote share for Republicans") + theme(legend.position = "right",
        panel.grid = element_blank(),
        axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.title.x = element_blank(),
        axis.title.y = element_blank())
```
We can see from the plots that a majority of states rarely flip for a different party. For example, California has voted for a Democrat every year since 1988 while Texas has voted for a Republican every cycle since 1980. More generally, more rural southern states in the "Sun" or "Bible" Belt have consistently voted for Republicans by large margins while coastal regions with denser urban areas like New England and the West Coast have supported Democrats. Ultimately, politicians know their bases of support. In the last presidential election, neither Joe Biden or Donald Trump held a campaign event in California, Oregon, or Washington State. As campaigners, it did not make sense for either candidate to spend time in these states because they were assured to vote for Biden. Instead, Biden and Trump focused most of their time and advertising dollars in "swing" states where voters tend to be more moderate. 

```{r, echo=FALSE}
swing_state_df <- pvstate_df %>%
    filter(raceYear >= 1976) %>%
    select(raceYear,State,RepVotes, DemVotes) %>%
  group_by(State,raceYear) %>%
  mutate(RepVotesTotal = sum(RepVotes),DemVotesTotal = sum(DemVotes)) %>%
  select(raceYear,State,RepVotesTotal,DemVotesTotal) %>% distinct() %>%
  mutate(partisanship = RepVotesTotal/(RepVotesTotal + DemVotesTotal))


new_df = swing_state_df %>%
  group_by(State) %>%
  mutate(swing = case_when(
    raceYear == 1984 ~ partisanship - partisanship[raceYear==1980],
    raceYear == 1986 ~ partisanship - partisanship[raceYear==1982],
    raceYear == 1988 ~ partisanship - partisanship[raceYear==1984],
    raceYear == 1990 ~ partisanship - partisanship[raceYear==1986],
    raceYear == 1992 ~ partisanship - partisanship[raceYear==1988],
    raceYear == 1994 ~ partisanship - partisanship[raceYear==1988],
    raceYear == 1996 ~ partisanship - partisanship[raceYear==1992],
    raceYear == 1998 ~ partisanship - partisanship[raceYear==1994],
    raceYear == 2000 ~ partisanship - partisanship[raceYear==1996],
    raceYear == 2002 ~ partisanship - partisanship[raceYear==1998],
    raceYear == 2004 ~ partisanship - partisanship[raceYear==2000],
    raceYear == 2006 ~ partisanship - partisanship[raceYear==2002],
    raceYear == 2008 ~ partisanship - partisanship[raceYear==2004],
    raceYear == 2010 ~ partisanship - partisanship[raceYear==2006],
    raceYear == 2012 ~ partisanship - partisanship[raceYear==2008],
    raceYear == 2014 ~ partisanship - partisanship[raceYear==2010],
    raceYear == 2016 ~ partisanship - partisanship[raceYear==2012],
    raceYear == 2018 ~ partisanship - partisanship[raceYear==2014],
    raceYear == 2020 ~ partisanship - partisanship[raceYear==2016]))%>%na.omit() 

colnames(new_df) = c("raceYear","state","RepVotesTotal","DemVotesTotal","partisanship","swing","swing2")
```


```{r}
plot_usmap(data = new_df, regions = "state", values = "swing") +
  facet_wrap(facets = raceYear~.) +
  scale_fill_gradient2(low = "blue",mid = "white",high = "red",limits = c(-.30,.30),name = "Swing Margin") + 
  labs(title = "Swing States for U.S. Presidential Elections over Time",subtitle = "Positive Numbers corresponds to a larger vote share for Republicans compared to the last election") + theme(legend.position = "right",
        panel.grid = element_blank(),
        axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.title.x = element_blank(),
        axis.title.y = element_blank())

# ggsave("swing.png", height = 6, width = 12)
```

As seen in the plots above, 
